{
    "name": "cerb.explore.worklist",
    "extension_id": "cerb.trigger.interaction.worker.explore",
    "description": "A custom explore mode that tracks real-time changes in a worklist and returns the top sorted unseen record. It maintains a circular ignore list of visited records.",
    "script": "inputs:\r\n  text/worklist_id:\r\n    type: freeform\r\n    required@bool: yes\r\n\r\nstart:\r\n  set:\r\n    ignore_list@csv:\r\n  \r\n  while:\r\n    if@bool: {{true}}\r\n    do:\r\n      api.command:\r\n        output: currentWorklist\r\n        inputs:\r\n          name: cerb.commands.worklist.search\r\n          params:\r\n            worker_id: {{worker_id}}\r\n            worklist_id: {{inputs.worklist_id}}\r\n            worklist_query@text:\r\n              {% if ignore_list is not empty %}\r\n              id:![{{ignore_list|join(',')}}]\r\n              {% endif %}\r\n              page:0\r\n              limit:1\r\n        on_success:\r\n          set/next:\r\n            nextTicket@key: currentWorklist:data\r\n          # If no next record, end\r\n          decision/result:\r\n            outcome/empty:\r\n              if@bool: {{not nextTicket.record_url}}\r\n              then:\r\n                await:\r\n                  explore:\r\n                    title: {{currentWorklist.worklist.name}}\r\n                    label@text: \r\n                    toolbar:\r\n                      interaction/next:\r\n                        label: Refresh\r\n                        icon: refresh\r\n                        keyboard: ]\r\n            outcome/next:\r\n              then:\r\n                # Limit the ignore list to 50 items\r\n                set:\r\n                  ignore_list@json: {{ignore_list|slice(-49)|merge([nextTicket.id|round])|json_encode}}\r\n                await:\r\n                  explore:\r\n                    title: {{currentWorklist.worklist.name}}\r\n                    label: {{nextTicket._label}}\r\n                    url: {{nextTicket.record_url}}\r\n                    toolbar:\r\n                      interaction/next:\r\n                        label: Next\r\n                        icon: chevron-right\r\n                        icon_at: end\r\n                        keyboard: ]",
    "policy_kata": "commands:\r\n  api.command:\r\n    deny/name@bool: {{inputs.name != 'cerb.commands.worklist.search'}}\r\n    allow@bool: yes",
    "created_at": 1691117647,
    "updated_at": 1691117647
}